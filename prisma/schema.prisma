// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserType {
  ADMIN
  JOB_SEEKER
  COMPANY
  ORGANIZATION
}

enum SubscriptionType {
  DIRECT
  INDIRECT
}

enum SubscriptionStatus {
  PENDING
  ACTIVE
  EXPIRED
  SUSPENDED
}

enum PaymentStatus {
  PENDING
  APPROVED
  REJECTED
  REFUNDED
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  ACCEPTED
  REJECTED
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  INTERNSHIP
}

// Main User model - unified authentication
model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  userType      UserType  @default(JOB_SEEKER)
  emailVerified DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  isActive      Boolean   @default(true)
  isSuspended   Boolean   @default(false)

  // Relations
  jobSeekerProfile    JobSeekerProfile?
  companyProfile      CompanyProfile?
  organizationProfile OrganizationProfile?
  subscriptions       Subscription[]
  payments            Payment[]
  jobPosts            JobPost[]
  applications        Application[]
  contacts            Contact[]
  sentContacts        Contact[] @relation("SentContacts")

  @@map("users")
}

// Job Seeker Profile
model JobSeekerProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  firstName       String
  lastName        String
  phone           String?
  profilePicture  String?
  bio             String?
  location        String?
  category        String?
  availability    String?
  currentJobTitle String?
  expectedSalary  String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isVisible       Boolean  @default(true)

  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  experiences  Experience[]
  educations   Education[]
  competencies Competency[]
  references   Reference[]
  languages    Language[]

  @@map("job_seeker_profiles")
}

// Experience
model Experience {
  id          String   @id @default(cuid())
  profileId   String
  company     String
  position    String
  description String?
  startDate   DateTime
  endDate     DateTime?
  isCurrent   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profile JobSeekerProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("experiences")
}

// Education
model Education {
  id          String   @id @default(cuid())
  profileId   String
  institution String
  degree      String
  field       String?
  startDate   DateTime
  endDate     DateTime?
  isCurrent   Boolean  @default(false)
  gpa         String?
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profile JobSeekerProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("educations")
}

// Competencies/Skills
model Competency {
  id          String   @id @default(cuid())
  profileId   String
  name        String
  level       String?  // e.g., Beginner, Intermediate, Advanced, Expert
  category    String?  // e.g., Technical, Soft Skills, etc.
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profile JobSeekerProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("competencies")
}

// References
model Reference {
  id          String   @id @default(cuid())
  profileId   String
  name        String
  position    String?
  company     String?
  email       String?
  phone       String?
  relationship String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profile JobSeekerProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("references")
}

// Languages
model Language {
  id          String   @id @default(cuid())
  profileId   String
  name        String
  proficiency String?  // e.g., Native, Fluent, Intermediate, Basic
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  profile JobSeekerProfile @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@map("languages")
}

// Company Profile (companies seeking contracts)
model CompanyProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  companyName     String
  registrationNumber String?
  phone           String?
  email           String?
  website         String?
  logo            String?
  description     String?
  industry        String?
  location        String?
  yearEstablished Int?
  employeeCount   String?
  services        String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isVisible       Boolean  @default(true)

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  contracts    ContractOffer[]

  @@map("company_profiles")
}

// Organization/Employer Profile
model OrganizationProfile {
  id              String   @id @default(cuid())
  userId          String   @unique
  organizationName String
  type            String   // Governmental, Private, etc.
  phone           String?
  email           String?
  website         String?
  logo            String?
  description     String?
  industry        String?
  location        String?
  employeeCount   String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isVisible       Boolean  @default(true)

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPosts     JobPost[]
  contracts    ContractOffer[]

  @@map("organization_profiles")
}

// Subscription
model Subscription {
  id          String             @id @default(cuid())
  userId      String
  type        SubscriptionType
  amount      Float
  status      SubscriptionStatus @default(PENDING)
  startDate   DateTime?
  endDate     DateTime?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt

  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  payments Payment[]

  @@map("subscriptions")
}

// Payment
model Payment {
  id          String        @id @default(cuid())
  userId      String
  subscriptionId String
  amount      Float
  status      PaymentStatus @default(PENDING)
  paymentMethod String?
  transactionId String?
  notes       String?
  approvedBy  String?       // Admin ID who approved
  approvedAt  DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscription Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// Job Post
model JobPost {
  id              String   @id @default(cuid())
  organizationId  String
  userId          String   // User who created it
  title           String
  description     String
  requirements    String?
  location        String?
  jobType         JobType
  salaryRange     String?
  category        String?
  isActive        Boolean  @default(true)
  applicationDeadline DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization OrganizationProfile @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  applications Application[]

  @@map("job_posts")
}

// Job Application
model Application {
  id          String            @id @default(cuid())
  jobPostId   String
  userId      String
  coverLetter String?
  status      ApplicationStatus @default(PENDING)
  reviewedAt  DateTime?
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobPost JobPost @relation(fields: [jobPostId], references: [id], onDelete: Cascade)

  @@map("applications")
}

// Contract Offer (for companies)
model ContractOffer {
  id              String   @id @default(cuid())
  companyId       String?
  organizationId  String?
  title           String
  description     String
  budget          String?
  duration        String?
  requirements    String?
  deadline        DateTime?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  company      CompanyProfile?      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  organization OrganizationProfile? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("contract_offers")
}

// Contact (when employers contact job seekers or companies)
model Contact {
  id          String   @id @default(cuid())
  senderId    String
  receiverId  String
  message     String
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())

  sender   User @relation("SentContacts", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User @relation(fields: [receiverId], references: [id], onDelete: Cascade)

  @@map("contacts")
}

// Advertisement
model Advertisement {
  id          String   @id @default(cuid())
  title       String
  description String?
  image       String?
  link        String?
  isActive    Boolean  @default(true)
  startDate   DateTime
  endDate     DateTime?
  position    String?  // Home page position
  clicks      Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("advertisements")
}

// Activity Log (for admin tracking)
model ActivityLog {
  id          String   @id @default(cuid())
  userId      String?
  action      String
  entityType  String?
  entityId    String?
  details     String?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@map("activity_logs")
}
